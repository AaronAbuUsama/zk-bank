<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zk-bank - CLI-Native Social Trading</title>
    <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Courier New", monospace;
      background-color: #000;
      color: #00ff00;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .banner {
      background-color: #111;
      padding: 8px 16px;
      border-bottom: 1px solid #333;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .price-ticker {
      display: flex;
      gap: 20px;
    }

    .price-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .price-up {
      color: #00ff00;
    }

    .price-down {
      color: #ff4444;
    }

    .alerts {
      color: #ffff00;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .tabs {
      background-color: #111;
      display: flex;
      border-bottom: 1px solid #333;
    }

    .tab {
      padding: 12px 24px;
      background-color: #111;
      border: none;
      color: #666;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab.active {
      color: #00ff00;
      border-bottom-color: #00ff00;
    }

    .tab:hover {
      color: #00ff00;
      background-color: #222;
    }

    .tab.chain-tab {
      background-color: #ff4444;
      color: #000;
    }

    .tab.chain-tab:hover {
      background-color: #ff6666;
    }

    .tab-content {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .page {
      display: none;
      height: 100%;
      overflow: auto;
    }

    .page.active {
      display: flex;
      flex-direction: column;
    }

    .dashboard {
      padding: 20px;
      background-color: #000;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-card {
      background-color: #111;
      padding: 16px;
      border-radius: 4px;
    }

    .stat-title {
      color: #666;
      font-size: 12px;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 18px;
      color: #00ff00;
      margin-bottom: 4px;
    }

    .stat-subtitle {
      font-size: 12px;
      color: #888;
    }

    .dashboard-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .create-position-btn {
      background-color: #00ff00;
      color: #000;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      font-weight: bold;
    }

    .create-position-btn:hover {
      background-color: #33ff33;
    }

    .positions-list {
      background-color: #111;
      border-radius: 4px;
      overflow: hidden;
    }

    .position-item {
      padding: 12px 16px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .position-item:hover {
      background-color: #222;
    }

    .position-item:last-child {
      border-bottom: none;
    }

    .position-info {
      display: flex;
      flex-direction: column;
    }

    .position-symbol {
      font-size: 16px;
      color: #00ff00;
    }

    .position-details {
      font-size: 12px;
      color: #888;
    }

    .position-ratio {
      font-size: 14px;
      color: #ffff00;
    }

    .trollbox {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background-color: #000;
    }

    .message {
      margin-bottom: 12px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      background-color: #333;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #00ff00;
    }

    .message-content {
      flex: 1;
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .message-username {
      font-weight: bold;
      color: #00ff00;
    }

    .message-time {
      font-size: 12px;
      color: #666;
    }

    .message-text {
      color: #fff;
      line-height: 1.4;
    }

    .liquidation-message {
      background-color: #220000;
      border-left: 4px solid #ff4444;
      padding: 12px 16px;
      margin: 8px 0;
    }

    .liquidation-message .message-text {
      color: #ffaaaa;
      font-weight: bold;
    }

    .chat-input-area {
      background-color: #111;
      border-top: 1px solid #333;
      padding: 16px;
    }

    .position-preview {
      background-color: #002200;
      border: 1px solid #00ff00;
      border-bottom: none;
      padding: 16px;
      display: none;
      position: relative;
    }

    .position-preview::after {
      content: "";
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid #002200;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .preview-title {
      color: #00ff00;
      font-size: 16px;
      font-weight: bold;
    }

    .preview-actions {
      display: flex;
      gap: 8px;
    }

    .preview-btn {
      background-color: #333;
      color: #00ff00;
      border: 1px solid #00ff00;
      padding: 4px 8px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
    }

    .preview-btn.confirm {
      background-color: #00ff00;
      color: #000;
    }

    .preview-btn:hover {
      background-color: #00ff00;
      color: #000;
    }

    .preview-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      font-size: 12px;
      margin-bottom: 12px;
    }

    .preview-detail {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-label {
      color: #888;
    }

    .preview-value {
      color: #00ff00;
      font-weight: bold;
    }

    .preview-impact {
      background-color: #001100;
      padding: 8px;
      border-radius: 2px;
      font-size: 11px;
      color: #88ff88;
    }

    .impact-positive {
      color: #00ff00;
    }

    .impact-negative {
      color: #ffaaaa;
    }

    .chat-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      background-color: #000;
      border: 1px solid #333;
      color: #00ff00;
      padding: 8px 12px;
      font-family: inherit;
      font-size: 14px;
    }

    .chat-input:focus {
      outline: none;
      border-color: #00ff00;
    }

    .send-button {
      background-color: #00ff00;
      color: #000;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }

    .send-button:hover {
      background-color: #33ff33;
    }

    .chain-explorer {
      padding: 20px;
      background-color: #000;
    }

    .chain-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .control-group {
      background-color: #111;
      padding: 16px;
      border-radius: 4px;
    }

    .control-title {
      color: #00ff00;
      font-size: 16px;
      margin-bottom: 12px;
    }

    .control-item {
      margin-bottom: 8px;
    }

    .control-label {
      display: block;
      color: #888;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .control-input {
      width: 100%;
      background-color: #000;
      border: 1px solid #333;
      color: #00ff00;
      padding: 6px 8px;
      font-family: inherit;
      font-size: 14px;
    }

    .control-input:focus {
      outline: none;
      border-color: #00ff00;
    }

    .control-button {
      background-color: #333;
      color: #00ff00;
      border: 1px solid #00ff00;
      padding: 6px 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      margin-right: 8px;
    }

    .control-button:hover {
      background-color: #00ff00;
      color: #000;
    }

    .events-log {
      background-color: #111;
      border-radius: 4px;
      padding: 16px;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }

    .event-item {
      margin-bottom: 8px;
      padding: 8px;
      background-color: #000;
      border-radius: 2px;
    }

    .event-type {
      color: #00ff00;
      font-weight: bold;
    }

    .event-data {
      color: #888;
      margin-top: 4px;
    }

    .footer {
      background-color: #111;
      padding: 8px 16px;
      border-top: 1px solid #333;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .status-info {
      display: flex;
      gap: 20px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #00ff00;
    }

    .key-hints {
      color: #666;
    }

    .gated-notice {
      background-color: #220000;
      border: 1px solid #ff4444;
      color: #ffaaaa;
      padding: 12px;
      margin: 16px 0;
      border-radius: 4px;
      text-align: center;
    }

    .chain-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: #000;
      z-index: 1000;
      display: none;
      overflow: auto;
    }

    .chain-fullscreen.active {
      display: block;
    }

    .chain-header {
      background-color: #111;
      padding: 16px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chain-title {
      color: #00ff00;
      font-size: 18px;
    }

    .chain-close {
      background-color: #ff4444;
      color: #000;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }

    .chain-fullscreen .chain-explorer {
      padding: 20px;
    }

    .position-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .position-modal.active {
      display: flex;
    }

    .position-modal-content {
      background-color: #111;
      border: 1px solid #333;
      border-radius: 4px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .position-modal-header {
      padding: 20px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .position-modal-title {
      color: #00ff00;
      font-size: 18px;
      margin: 0;
    }

    .position-modal-close {
      background-color: #ff4444;
      color: #000;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }

    .position-details {
      padding: 20px;
    }

    .position-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .position-stat {
      background-color: #000;
      padding: 12px;
      border-radius: 2px;
    }

    .position-stat-label {
      color: #888;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .position-stat-value {
      color: #00ff00;
      font-size: 16px;
      font-weight: bold;
    }

    .position-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .action-group {
      background-color: #000;
      padding: 16px;
      border-radius: 2px;
    }

    .action-title {
      color: #00ff00;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .action-form {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .action-input {
      background-color: #111;
      border: 1px solid #333;
      color: #00ff00;
      padding: 8px;
      font-family: inherit;
      font-size: 14px;
    }

    .action-input:focus {
      outline: none;
      border-color: #00ff00;
    }

    .action-button {
      background-color: #333;
      color: #00ff00;
      border: 1px solid #00ff00;
      padding: 8px 16px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      margin-top: 8px;
    }

    .action-button:hover {
      background-color: #00ff00;
      color: #000;
    }

    .create-position-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .create-position-modal.active {
      display: flex;
    }

    .create-position-content {
      background-color: #111;
      border: 1px solid #333;
      border-radius: 4px;
      width: 90%;
      max-width: 500px;
      padding: 20px;
    }

    .create-position-title {
      color: #00ff00;
      font-size: 18px;
      margin-bottom: 20px;
    }

    .create-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .form-label {
      color: #888;
      font-size: 12px;
    }

    .form-input {
      background-color: #000;
      border: 1px solid #333;
      color: #00ff00;
      padding: 8px 12px;
      font-family: inherit;
      font-size: 14px;
    }

    .form-input:focus {
      outline: none;
      border-color: #00ff00;
    }

    .form-select {
      background-color: #000;
      border: 1px solid #333;
      color: #00ff00;
      padding: 8px 12px;
      font-family: inherit;
      font-size: 14px;
    }

    .create-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .create-btn {
      flex: 1;
      background-color: #00ff00;
      color: #000;
      border: none;
      padding: 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      font-weight: bold;
    }

    .create-btn:hover {
      background-color: #33ff33;
    }

    .cancel-btn {
      flex: 1;
      background-color: #333;
      color: #00ff00;
      border: 1px solid #00ff00;
      padding: 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }

    .cancel-btn:hover {
      background-color: #00ff00;
      color: #000;
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .chain-controls {
        grid-template-columns: 1fr;
      }

      .banner {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .footer {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }
    }
    </style>
  </head>
  <body>
    <!-- Banner -->
    <div class="banner">
      <div class="price-ticker">
        <div class="price-item">
          <span>ETH:</span>
          <span class="price-up">$2,847.32</span>
          <span>(+2.1%)</span>
        </div>
        <div class="price-item">
          <span>BTC:</span>
          <span class="price-down">$43,521.89</span>
          <span>(-1.3%)</span>
        </div>
        <div class="price-item">
          <span>LUSD:</span>
          <span>$1.02</span>
          <span>(+0.2%)</span>
        </div>
      </div>
      <div class="alerts">‚ö†Ô∏è High volatility detected</div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="dashboard">Dashboard</button>
        <button class="tab" data-tab="trollbox">Trollbox</button>
        <button
          class="tab chain-tab"
          data-tab="chain"
          onclick="openChainExplorer()"
        >
          Chain/Explorer
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active dashboard">
          <div class="dashboard-actions">
            <h2 style="color: #00ff00; margin: 0;">Portfolio Overview</h2>
            <button
              class="create-position-btn"
              onclick="openCreatePositionModal()"
            >
              + Create Position
            </button>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-title">Total Collateral</div>
              <div class="stat-value">$12,847.32</div>
              <div class="stat-subtitle">Across 3 positions</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Total Debt</div>
              <div class="stat-value">$8,432.15</div>
              <div class="stat-subtitle">LUSD borrowed</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Avg. CR</div>
              <div class="stat-value">152%</div>
              <div class="stat-subtitle">Collateralization ratio</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Liquidation Risk</div>
              <div class="stat-value">Low</div>
              <div class="stat-subtitle">All positions safe</div>
            </div>
          </div>

          <div class="positions-list">
            <div
              class="position-item"
              onclick="openPositionModal('ETH Position #1', 'ETH', 4.2, 11932.14, 187)"
            >
              <div class="position-info">
                <div class="position-symbol">ETH Position #1</div>
                <div class="position-details">
                  4.2 ETH collateral ‚Ä¢ $11,932.14 debt
                </div>
              </div>
              <div class="position-ratio">187%</div>
            </div>
            <div
              class="position-item"
              onclick="openPositionModal('WBTC Position #2', 'WBTC', 0.15, 6432.15, 145)"
            >
              <div class="position-info">
                <div class="position-symbol">WBTC Position #2</div>
                <div class="position-details">
                  0.15 WBTC collateral ‚Ä¢ $6,432.15 debt
                </div>
              </div>
              <div class="position-ratio">145%</div>
            </div>
            <div
              class="position-item"
              onclick="openPositionModal('UNI Position #3', 'UNI', 250, 2847.32, 132)"
            >
              <div class="position-info">
                <div class="position-symbol">UNI Position #3</div>
                <div class="position-details">
                  250 UNI collateral ‚Ä¢ $2,847.32 debt
                </div>
              </div>
              <div class="position-ratio">132%</div>
            </div>
          </div>
        </div>

        <!-- Trollbox Page -->
        <div id="trollbox" class="page trollbox">
          <div class="gated-notice">
            üí¨ You need at least $100 in positions to participate in chat.
            Current: $12,847.32 ‚úì
          </div>

          <div class="chat-messages" id="chat-messages">
            <div class="message">
              <div class="message-avatar">A</div>
              <div class="message-content">
                <div class="message-header">
                  <span class="message-username">anon_trader_42</span>
                  <span class="message-time">14:32:15</span>
                </div>
                <div class="message-text">
                  Just opened a 2x ETH long. Market looks bullish today üìà
                </div>
              </div>
            </div>

            <div class="liquidation-message">
              <div class="message-content">
                <div class="message-header">
                  <span class="message-username">SYSTEM</span>
                  <span class="message-time">14:31:42</span>
                </div>
                <div class="message-text">
                  üö® LIQUIDATION: anon_trader_99 position liquidated! -23.4%
                  loss ‚Ä¢ Streak: 3
                </div>
              </div>
            </div>

            <div class="message">
              <div class="message-avatar">B</div>
              <div class="message-content">
                <div class="message-header">
                  <span class="message-username">degen_max</span>
                  <span class="message-time">14:30:28</span>
                </div>
                <div class="message-text">
                  Anyone else seeing this ETH pump? I'm going all in on leverage
                </div>
              </div>
            </div>

            <div class="message">
              <div class="message-avatar">ü§ñ</div>
              <div class="message-content">
                <div class="message-header">
                  <span class="message-username">market_analyzer</span>
                  <span class="message-time">14:29:15</span>
                </div>
                <div class="message-text">
                  Based on current volatility, I'd recommend maintaining CR
                  above 160% for ETH positions
                </div>
              </div>
            </div>

            <div class="message">
              <div class="message-avatar">C</div>
              <div class="message-content">
                <div class="message-header">
                  <span class="message-username">hodl_master</span>
                  <span class="message-time">14:28:03</span>
                </div>
                <div class="message-text">
                  Just added more collateral to my position. Staying safe in
                  this market
                </div>
              </div>
            </div>
          </div>

          <div class="chat-input-area">
            <div class="position-preview" id="position-preview">
              <div class="preview-header">
                <div class="preview-title">
                  ü§ñ zk-agent suggests: 2x Long ETH Position
                </div>
                <div class="preview-actions">
                  <button class="preview-btn" onclick="cancelPreview()">
                    Cancel
                  </button>
                  <button class="preview-btn confirm" onclick="confirmTrade()">
                    Confirm Trade
                  </button>
                </div>
              </div>
              <div class="preview-details">
                <div class="preview-detail">
                  <span class="preview-label">Collateral:</span>
                  <span class="preview-value">1.0 ETH ($2,847.32)</span>
                </div>
                <div class="preview-detail">
                  <span class="preview-label">Debt:</span>
                  <span class="preview-value">$1,423.66 LUSD</span>
                </div>
                <div class="preview-detail">
                  <span class="preview-label">Leverage:</span>
                  <span class="preview-value">2x</span>
                </div>
                <div class="preview-detail">
                  <span class="preview-label">CR:</span>
                  <span class="preview-value">141%</span>
                </div>
              </div>
              <div class="preview-impact">
                üìä Portfolio Impact:
                <span class="impact-positive">+2x ETH exposure</span>‚Ä¢<span
                  class="impact-negative"
                  >-$1,423.66 liquidity</span
                >‚Ä¢ Liquidation at: $1,423.66 ETH
              </div>
            </div>

            <div class="chat-input-container">
              <input
                type="text"
                class="chat-input"
                id="chat-input"
                placeholder="Type a message or trade command (e.g., '2x long ETH')..."
              >
              <button class="send-button" id="send-button">Send</button>
            </div>
          </div>
        </div>

        <!-- Chain/Explorer Page -->
        <div id="chain" class="page chain-explorer">
          <div class="chain-controls">
            <div class="control-group">
              <div class="control-title">Contract Deployment</div>
              <div class="control-item">
                <label class="control-label">Contract Path</label>
                <input
                  type="text"
                  class="control-input"
                  placeholder="src/Contract.sol"
                >
              </div>
              <div class="control-item">
                <label class="control-label">Constructor Args</label>
                <input
                  type="text"
                  class="control-input"
                  placeholder="arg1,arg2,arg3"
                >
              </div>
              <button class="control-button">Deploy to Local</button>
              <button class="control-button">Deploy to Fork</button>
            </div>

            <div class="control-group">
              <div class="control-title">Block Manipulation</div>
              <div class="control-item">
                <label class="control-label">Advance Time (seconds)</label>
                <input type="number" class="control-input" placeholder="3600">
              </div>
              <div class="control-item">
                <label class="control-label">Set Block Number</label>
                <input
                  type="number"
                  class="control-input"
                  placeholder="18500000"
                >
              </div>
              <button class="control-button">Advance Time</button>
              <button class="control-button">Set Block</button>
            </div>

            <div class="control-group">
              <div class="control-title">Oracle Control</div>
              <div class="control-item">
                <label class="control-label">Asset</label>
                <select class="control-input">
                  <option>ETH</option>
                  <option>BTC</option>
                  <option>UNI</option>
                </select>
              </div>
              <div class="control-item">
                <label class="control-label">Price ($)</label>
                <input
                  type="number"
                  class="control-input"
                  placeholder="2847.32"
                >
              </div>
              <button class="control-button">Set Price</button>
            </div>
          </div>

          <div class="control-group">
            <div class="control-title">Protocol Events</div>
            <div class="events-log" id="events-log">
              <div class="event-item">
                <div class="event-type">PositionOpened</div>
                <div class="event-data">
                  owner: 0x742d35Cc6634C0532925a3b844Bc454e4438f44e ‚Ä¢
                  collateral: 4.2 ETH ‚Ä¢ debt: 11932.14 LUSD
                </div>
              </div>
              <div class="event-item">
                <div class="event-type">Liquidation</div>
                <div class="event-data">
                  position: #1847 ‚Ä¢ collateralClaimed: 2.1 ETH ‚Ä¢ debtRepaid:
                  5847.32 LUSD ‚Ä¢ liquidator:
                  0x8ba1f109551bD432803012645ac136ddd64DBA72
                </div>
              </div>
              <div class="event-item">
                <div class="event-type">CollateralAdded</div>
                <div class="event-data">
                  position: #1842 ‚Ä¢ added: 0.5 ETH ‚Ä¢ newCR: 165%
                </div>
              </div>
              <div class="event-item">
                <div class="event-type">DebtRepaid</div>
                <div class="event-data">
                  position: #1839 ‚Ä¢ repaid: 1000 LUSD ‚Ä¢ remainingDebt: 5432.15
                  LUSD
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Full Screen Chain Explorer -->
    <div class="chain-fullscreen" id="chain-fullscreen">
      <div class="chain-header">
        <div class="chain-title">üîó Chain Explorer / Developer Console</div>
        <button class="chain-close" onclick="closeChainExplorer()">
          Close [ESC]
        </button>
      </div>
      <div class="chain-explorer">
        <div class="chain-controls">
          <div class="control-group">
            <div class="control-title">Contract Deployment</div>
            <div class="control-item">
              <label class="control-label">Contract Path</label>
              <input
                type="text"
                class="control-input"
                placeholder="src/Contract.sol"
              >
            </div>
            <div class="control-item">
              <label class="control-label">Constructor Args</label>
              <input
                type="text"
                class="control-input"
                placeholder="arg1,arg2,arg3"
              >
            </div>
            <button class="control-button">Deploy to Local</button>
            <button class="control-button">Deploy to Fork</button>
          </div>

          <div class="control-group">
            <div class="control-title">Block Manipulation</div>
            <div class="control-item">
              <label class="control-label">Advance Time (seconds)</label>
              <input type="number" class="control-input" placeholder="3600">
            </div>
            <div class="control-item">
              <label class="control-label">Set Block Number</label>
              <input type="number" class="control-input" placeholder="18500000">
            </div>
            <button class="control-button">Advance Time</button>
            <button class="control-button">Set Block</button>
          </div>

          <div class="control-group">
            <div class="control-title">Oracle Control</div>
            <div class="control-item">
              <label class="control-label">Asset</label>
              <select class="control-input">
                <option>ETH</option>
                <option>BTC</option>
                <option>UNI</option>
              </select>
            </div>
            <div class="control-item">
              <label class="control-label">Price ($)</label>
              <input type="number" class="control-input" placeholder="2847.32">
            </div>
            <button class="control-button">Set Price</button>
          </div>
        </div>

        <div class="control-group">
          <div class="control-title">Protocol Events</div>
          <div class="events-log" id="events-log-fullscreen">
            <div class="event-item">
              <div class="event-type">PositionOpened</div>
              <div class="event-data">
                owner: 0x742d35Cc6634C0532925a3b844Bc454e4438f44e ‚Ä¢ collateral:
                4.2 ETH ‚Ä¢ debt: 11932.14 LUSD
              </div>
            </div>
            <div class="event-item">
              <div class="event-type">Liquidation</div>
              <div class="event-data">
                position: #1847 ‚Ä¢ collateralClaimed: 2.1 ETH ‚Ä¢ debtRepaid:
                5847.32 LUSD ‚Ä¢ liquidator:
                0x8ba1f109551bD432803012645ac136ddd64DBA72
              </div>
            </div>
            <div class="event-item">
              <div class="event-type">CollateralAdded</div>
              <div class="event-data">
                position: #1842 ‚Ä¢ added: 0.5 ETH ‚Ä¢ newCR: 165%
              </div>
            </div>
            <div class="event-item">
              <div class="event-type">DebtRepaid</div>
              <div class="event-data">
                position: #1839 ‚Ä¢ repaid: 1000 LUSD ‚Ä¢ remainingDebt: 5432.15
                LUSD
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Position Detail Modal -->
    <div class="position-modal" id="position-modal">
      <div class="position-modal-content">
        <div class="position-modal-header">
          <h2 class="position-modal-title" id="position-modal-title">
            Position Details
          </h2>
          <button class="position-modal-close" onclick="closePositionModal()">
            Close
          </button>
        </div>
        <div class="position-details">
          <div class="position-stats" id="position-stats">
            <!-- Stats will be populated by JavaScript -->
          </div>
          <div class="position-actions">
            <div class="action-group">
              <div class="action-title">Add Collateral</div>
              <div class="action-form">
                <input
                  type="number"
                  class="action-input"
                  id="add-collateral-amount"
                  placeholder="Amount"
                  step="0.01"
                >
                <button class="action-button" onclick="addCollateral()">
                  Add Collateral
                </button>
              </div>
            </div>
            <div class="action-group">
              <div class="action-title">Repay Debt</div>
              <div class="action-form">
                <input
                  type="number"
                  class="action-input"
                  id="repay-debt-amount"
                  placeholder="LUSD Amount"
                  step="0.01"
                >
                <button class="action-button" onclick="repayDebt()">
                  Repay Debt
                </button>
              </div>
            </div>
            <div class="action-group">
              <div class="action-title">Withdraw Collateral</div>
              <div class="action-form">
                <input
                  type="number"
                  class="action-input"
                  id="withdraw-collateral-amount"
                  placeholder="Amount"
                  step="0.01"
                >
                <button class="action-button" onclick="withdrawCollateral()">
                  Withdraw
                </button>
              </div>
            </div>
            <div class="action-group">
              <div class="action-title">Draw More Debt</div>
              <div class="action-form">
                <input
                  type="number"
                  class="action-input"
                  id="draw-debt-amount"
                  placeholder="LUSD Amount"
                  step="0.01"
                >
                <button class="action-button" onclick="drawDebt()">
                  Draw Debt
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Position Modal -->
    <div class="create-position-modal" id="create-position-modal">
      <div class="create-position-content">
        <h2 class="create-position-title">Create New Position</h2>
        <form class="create-form" onsubmit="createPosition(event)">
          <div class="form-group">
            <label class="form-label">Collateral Asset</label>
            <select class="form-select" id="collateral-asset" required>
              <option value="ETH">ETH</option>
              <option value="WBTC">WBTC</option>
              <option value="UNI">UNI</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Collateral Amount</label>
            <input
              type="number"
              class="form-input"
              id="collateral-amount"
              placeholder="1.0"
              step="0.01"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label">Debt Amount (LUSD)</label>
            <input
              type="number"
              class="form-input"
              id="debt-amount"
              placeholder="1000"
              step="0.01"
              required
            >
          </div>
          <div class="create-buttons">
            <button
              type="button"
              class="cancel-btn"
              onclick="closeCreatePositionModal()"
            >
              Cancel
            </button>
            <button type="submit" class="create-btn">Create Position</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="status-info">
        <div class="status-item">
          <div class="status-dot"></div>
          <span>Connected to Anvil</span>
        </div>
        <div class="status-item">
          <div class="status-dot"></div>
          <span>Block: 18549283</span>
        </div>
        <div class="status-item">
          <div class="status-dot"></div>
          <span>Wallet: 0x742d...f44e</span>
        </div>
      </div>
      <div class="key-hints">Tab: Switch tabs ‚Ä¢ ?: Help ‚Ä¢ Esc: Cancel</div>
    </div>

    <script>
    "use strict";
    // Tab switching functionality
    const tabs = document.querySelectorAll(".tab:not(.chain-tab)");
    const pages = document.querySelectorAll(".page");

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        // Remove active class from all tabs and pages
        tabs.forEach((t) => t.classList.remove("active"));
        pages.forEach((p) => p.classList.remove("active"));

        // Add active class to clicked tab and corresponding page
        tab.classList.add("active");
        const tabName = tab.getAttribute("data-tab");
        document.getElementById(tabName).classList.add("active");
      });
    });

    // Full screen chain explorer
    function openChainExplorer() {
      document.getElementById("chain-fullscreen").classList.add("active");
    }

    function closeChainExplorer() {
      document.getElementById("chain-fullscreen").classList.remove("active");
    }

    // Handle ESC key to close modals
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeChainExplorer();
        closePositionModal();
        closeCreatePositionModal();
      }
    });

    // Position modal functions
    let currentPosition = null;

    function openPositionModal(title, asset, collateral, debt, cr) {
      currentPosition = { title, asset, collateral, debt, cr };
      document.getElementById("position-modal-title").textContent = title;

      const statsContainer = document.getElementById("position-stats");
      const collateralValue =
        asset === "ETH"
          ? collateral * 2847.32
          : asset === "WBTC"
            ? collateral * 43_521.89
            : collateral * 1.0;

      statsContainer.innerHTML = `
                <div class="position-stat">
                    <div class="position-stat-label">Collateral</div>
                    <div class="position-stat-value">${collateral} ${asset} ($${collateralValue.toFixed(2)})</div>
                </div>
                <div class="position-stat">
                    <div class="position-stat-label">Debt</div>
                    <div class="position-stat-value">$${debt.toFixed(2)} LUSD</div>
                </div>
                <div class="position-stat">
                    <div class="position-stat-label">Collateralization Ratio</div>
                    <div class="position-stat-value">${cr}%</div>
                </div>
                <div class="position-stat">
                    <div class="position-stat-label">Liquidation Price</div>
                    <div class="position-stat-value">$${(debt / collateral).toFixed(2)} ${asset}</div>
                </div>
                <div class="position-stat">
                    <div class="position-stat-label">Leverage</div>
                    <div class="position-stat-value">${(collateralValue / (collateralValue - debt)).toFixed(1)}x</div>
                </div>
                <div class="position-stat">
                    <div class="position-stat-label">Risk Level</div>
                    <div class="position-stat-value" style="color: ${cr > 200 ? "#00ff00" : cr > 150 ? "#ffff00" : "#ff4444"}">${cr > 200 ? "Low" : cr > 150 ? "Medium" : "High"}</div>
                </div>
            `;

      document.getElementById("position-modal").classList.add("active");
    }

    function closePositionModal() {
      document.getElementById("position-modal").classList.remove("active");
      currentPosition = null;
    }

    function addCollateral() {
      const amount = Number.parseFloat(
        document.getElementById("add-collateral-amount").value
      );
      if (amount > 0) {
        alert(
          `Added ${amount} ${currentPosition.asset} collateral to ${currentPosition.title}`
        );
        document.getElementById("add-collateral-amount").value = "";
        closePositionModal();
      }
    }

    function repayDebt() {
      const amount = Number.parseFloat(
        document.getElementById("repay-debt-amount").value
      );
      if (amount > 0) {
        alert(`Repaid $${amount} LUSD debt from ${currentPosition.title}`);
        document.getElementById("repay-debt-amount").value = "";
        closePositionModal();
      }
    }

    function withdrawCollateral() {
      const amount = Number.parseFloat(
        document.getElementById("withdraw-collateral-amount").value
      );
      if (amount > 0) {
        alert(
          `Withdrew ${amount} ${currentPosition.asset} collateral from ${currentPosition.title}`
        );
        document.getElementById("withdraw-collateral-amount").value = "";
        closePositionModal();
      }
    }

    function drawDebt() {
      const amount = Number.parseFloat(
        document.getElementById("draw-debt-amount").value
      );
      if (amount > 0) {
        alert(
          `Drew $${amount} additional LUSD debt from ${currentPosition.title}`
        );
        document.getElementById("draw-debt-amount").value = "";
        closePositionModal();
      }
    }

    // Create position modal functions
    function openCreatePositionModal() {
      document.getElementById("create-position-modal").classList.add("active");
    }

    function closeCreatePositionModal() {
      document
        .getElementById("create-position-modal")
        .classList.remove("active");
      document.getElementById("collateral-asset").value = "ETH";
      document.getElementById("collateral-amount").value = "";
      document.getElementById("debt-amount").value = "";
    }

    function createPosition(event) {
      event.preventDefault();

      const asset = document.getElementById("collateral-asset").value;
      const collateral = Number.parseFloat(
        document.getElementById("collateral-amount").value
      );
      const debt = Number.parseFloat(
        document.getElementById("debt-amount").value
      );

      if (collateral > 0 && debt > 0) {
        const cr = (
          ((collateral *
            (asset === "ETH" ? 2847.32 : asset === "WBTC" ? 43_521.89 : 1.0)) /
            debt) *
          100
        ).toFixed(0);
        alert(
          `Created new ${asset} position: ${collateral} ${asset} collateral, $${debt} LUSD debt (${cr}% CR)`
        );
        closeCreatePositionModal();
        // In a real app, this would refresh the positions list
      }
    }

    // Chat functionality
    const chatInput = document.getElementById("chat-input");
    const sendButton = document.getElementById("send-button");
    const chatMessages = document.getElementById("chat-messages");
    const positionPreview = document.getElementById("position-preview");

    // Enhanced trade command detection and parsing
    function parseTradeCommand(message) {
      const patterns = [
        /(\d+)x\s+(long|short)\s+(\w+)/i,
        /(long|short)\s+(\w+)\s+(\d+)x/i,
        /(long|short)\s+(\w+)/i,
        /(\d+)x\s+(\w+)/i,
      ];

      for (const pattern of patterns) {
        const match = message.match(pattern);
        if (match) {
          let leverage = 1;
          let side = "long";
          let asset = "ETH";

          if (match[1] && !isNaN(match[1])) {
            leverage = Number.parseInt(match[1]);
            side = match[2] || "long";
            asset = match[3] || match[2] || "ETH";
          } else if (match[2] && !isNaN(match[2])) {
            leverage = Number.parseInt(match[2]);
            side = match[1];
            asset = match[3] || "ETH";
          } else {
            side = match[1] || "long";
            asset = match[2] || match[1] || "ETH";
          }

          return { leverage, side, asset: asset.toUpperCase() };
        }
      }
      return null;
    }

    function generatePositionPreview(trade) {
      const { leverage, side, asset } = trade;
      const collateral = 1.0; // Default collateral
      const currentPrice =
        asset === "ETH" ? 2847.32 : asset === "BTC" ? 43_521.89 : 1.0;
      const debt = (collateral * currentPrice) / leverage;
      const cr = ((collateral * currentPrice) / debt) * 100;

      return {
        collateral,
        asset,
        debt,
        leverage,
        side,
        cr: cr.toFixed(0),
        liquidationPrice: (debt / collateral).toFixed(2),
      };
    }

    function updatePositionPreview(message) {
      const trade = parseTradeCommand(message);
      if (trade) {
        const preview = generatePositionPreview(trade);
        positionPreview.innerHTML = `
                    <div class="preview-header">
                        <div class="preview-title">ü§ñ zk-agent suggests: ${preview.leverage}x ${preview.side.charAt(0).toUpperCase() + preview.side.slice(1)} ${preview.asset} Position</div>
                        <div class="preview-actions">
                            <button class="preview-btn" onclick="cancelPreview()">Cancel</button>
                            <button class="preview-btn confirm" onclick="confirmTrade('${preview.leverage}x ${preview.side} ${preview.asset}')">Confirm Trade</button>
                        </div>
                    </div>
                    <div class="preview-details">
                        <div class="preview-detail">
                            <span class="preview-label">Collateral:</span>
                            <span class="preview-value">${preview.collateral} ${preview.asset} ($${(preview.collateral * (preview.asset === "ETH" ? 2847.32 : preview.asset === "BTC" ? 43_521.89 : 1.0)).toFixed(2)})</span>
                        </div>
                        <div class="preview-detail">
                            <span class="preview-label">Debt:</span>
                            <span class="preview-value">$${preview.debt.toFixed(2)} LUSD</span>
                        </div>
                        <div class="preview-detail">
                            <span class="preview-label">Leverage:</span>
                            <span class="preview-value">${preview.leverage}x</span>
                        </div>
                        <div class="preview-detail">
                            <span class="preview-label">CR:</span>
                            <span class="preview-value">${preview.cr}%</span>
                        </div>
                    </div>
                    <div class="preview-impact">
                        üìä Portfolio Impact: <span class="impact-${preview.side === "long" ? "positive" : "negative"}">+${preview.leverage}x ${preview.asset} ${preview.side}</span> ‚Ä¢
                        <span class="impact-negative">-${preview.debt.toFixed(2)} liquidity</span> ‚Ä¢
                        Liquidation at: $${preview.liquidationPrice} ${preview.asset}
                    </div>
                `;
        positionPreview.style.display = "block";
      } else {
        positionPreview.style.display = "none";
      }
    }

    function cancelPreview() {
      positionPreview.style.display = "none";
      chatInput.value = "";
    }

    function confirmTrade(tradeDescription) {
      // Add the trade message to chat
      const messageElement = document.createElement("div");
      messageElement.className = "message";
      messageElement.innerHTML = `
                <div class="message-avatar">U</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-username">you</span>
                        <span class="message-time">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <div class="message-text">${chatInput.value}</div>
                </div>
            `;
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Clear input and hide preview
      chatInput.value = "";
      positionPreview.style.display = "none";

      // Simulate successful trade execution
      setTimeout(() => {
        const responseElement = document.createElement("div");
        responseElement.className = "message";
        responseElement.innerHTML = `
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-username">zk_agent</span>
                            <span class="message-time">${new Date().toLocaleTimeString()}</span>
                        </div>
                        <div class="message-text">‚úÖ Trade executed: ${tradeDescription} position opened successfully!</div>
                    </div>
                `;
        chatMessages.appendChild(responseElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 1000);
    }

    chatInput.addEventListener("input", (e) => {
      updatePositionPreview(e.target.value);
    });

    sendButton.addEventListener("click", () => {
      const message = chatInput.value.trim();
      if (message && !parseTradeCommand(message)) {
        // Regular message
        const messageElement = document.createElement("div");
        messageElement.className = "message";
        messageElement.innerHTML = `
                    <div class="message-avatar">U</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-username">you</span>
                            <span class="message-time">${new Date().toLocaleTimeString()}</span>
                        </div>
                        <div class="message-text">${message}</div>
                    </div>
                `;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        chatInput.value = "";
      }
    });

    chatInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendButton.click();
      }
    });

    // Simulate live price updates
    setInterval(() => {
      const ethPrice = (2847 + (Math.random() - 0.5) * 50).toFixed(2);
      const btcPrice = (43_521 + (Math.random() - 0.5) * 500).toFixed(2);
      const lusdPrice = (1.02 + (Math.random() - 0.5) * 0.02).toFixed(2);

      document.querySelector(".price-ticker").innerHTML = `
                <div class="price-item">
                    <span>ETH:</span>
                    <span class="price-up">$${ethPrice}</span>
                    <span>(${Math.random() > 0.5 ? "+" : "-"}${(Math.random() * 2).toFixed(1)}%)</span>
                </div>
                <div class="price-item">
                    <span>BTC:</span>
                    <span class="${Math.random() > 0.5 ? "price-up" : "price-down"}">$${btcPrice}</span>
                    <span>(${Math.random() > 0.5 ? "+" : "-"}${(Math.random() * 3).toFixed(1)}%)</span>
                </div>
                <div class="price-item">
                    <span>LUSD:</span>
                    <span>$${lusdPrice}</span>
                    <span>(${Math.random() > 0.5 ? "+" : "-"}${(Math.random() * 0.5).toFixed(1)}%)</span>
                </div>
            `;
    }, 5000);

    // Simulate occasional liquidation events
    setInterval(() => {
      if (Math.random() < 0.1) {
        // 10% chance every 30 seconds
        const liquidationElement = document.createElement("div");
        liquidationElement.className = "liquidation-message";
        liquidationElement.innerHTML = `
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-username">SYSTEM</span>
                            <span class="message-time">${new Date().toLocaleTimeString()}</span>
                        </div>
                        <div class="message-text">üö® LIQUIDATION: anon_trader_${Math.floor(Math.random() * 100)} position liquidated! -${(Math.random() * 30 + 10).toFixed(1)}% loss ‚Ä¢ Streak: ${Math.floor(Math.random() * 5) + 1}</div>
                    </div>
                `;
        chatMessages.appendChild(liquidationElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }, 30_000);
    </script>
  </body>
</html>
